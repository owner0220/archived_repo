- 학습을 위해 글을 올립니다.
- 모든 출처와 저작권은 Geeksforgeeks에 있습니다.

[^출처]: https://www.geeksforgeeks.org/



# 프로세스 동기화_세마포어를 사용하는 생산자 소비자 문제

- 세마포어 S는 정수 두 기준 조작을 통해 액세스 할 수 있는 변수이다. 
- wait()와 signal()
- wait() : 세마포어의 값을 1 줄이는 역할을 한다.
- signal() : 세마포어의 값을 1 증가하는 역할을 한다.

```c
wait(S){
while(S<=0);   // busy waiting
S--;
}

signal(S){
S++;
}
```

#### 세마포어 2가지 유형

##### 1. 바이너리 세마포어

- 뮤텍스 잠금이라고도 한다. 0과 1의 두가지 값만 가질 수 있으며 이 값은 1로 초기화된다. 여러 프로세스에서 중요한 섹현 문제의 솔루션을 구현하는데 사용된다.

##### 2. 세마포어 계산

- 이 값은 제한되지 않은 도메인 범위 속에 할 수 있다. 여러 인스턴스가 있는 자원에 대한 액세스를 제어하는 데 사용된다.



##### 문제 설명

- 고정 크기의 버퍼가 있다. 생산자는 항목을 생성하고 버퍼에 배치 할 수 있다. 소비자는 항목을 선택해 소비할 수 있다. 생산자가 버퍼에 항목을 배치 할 때 동시에 소비자는 어떤 항목도 소비하지 않아야 한다.

##### 해결책

- 풀 카운트와 빈 카운트의 세마포어가 필요하다 "Full"은 주어진 시간에 버퍼의 항목 수를 추적하고 "Empty"는 비어있는 슬롯의 수를 추적한다.

###### 세마포어의 초기화

- 뮤텍스 = 1
- Full = 0 // 처음에 모든 슬롯이 비어 있으므로 전체 슬롯은 0이다.
- Empty = n // 처음에 모든 슬롯이 비어 있으니까 빈 슬롯 갯수는 n개이다.

###### 생산자 해결책

```c
do{

//produce an item

wait(empty);
wait(mutex);

//place in buffer

signal(mutex);
signal(full);

}while(true)
```

- 생산자가 아이템을 생산할 때, 하나의 슬롯이 이제 채워지기 때문에 "empty"의 값을 1씩 감소한다. 소비자가 버퍼에 액세스 하지 못하도록 뮤텍스 값도 줄인다. 이제 생산자가 항목을 배치했으므로 "Full"의 값이 1씩 증가한다. 뮤텍스 값도 1증가해 제작자의 작업이 완료되고 소비자가 버퍼에 액세스 할 수 있다.

###### 소비자 해결책

```c
do{

wait(full);
wait(mutex);

// remove item from buffer

signal(mutex);
signal(empty);

// consumes item

}while(true)
```

- 소비자가 버퍼에서 항목을 제거할 때 "Full"값이 1씩 줄어들고 뮤텍스 값도 감소되므로 제작자가 이 순간에 버퍼에 액세스 할 수 없다. 이제 소비자가 항목을 소비하므로 "Empty"값이 1씩 증가한다. 뮤텍스 값도 증가하므로 제작자가 버퍼에 즉시 액세스 할 수 있다.