- 학습을 위해 글을 올립니다.
- 모든 출처와 저작권은 Geeksforgeeks에 있습니다.

[^출처]: https://www.geeksforgeeks.org/



# 메모리관리_캐시 메모리

- **캐시 메모리**는 특별한 초고속 메모리이다. 고속 CPU와의 동기화 및 속도 향상에 사용된다. 캐시 메모리는 주 메모리 또는 디스크 메모리보다 비용이 많이 들고 CPU 레지스터보다 경제적이다. 캐시 메모리는 RAM과 CPU 사이의 버퍼 역할을 하는 매우 빠른 메모리 유형이다. 자주 요청되는 데이터와 명령을 보유하여 필요할 때 즉시 CPU에서 사용할 수 있도록 한다.
- 캐시 메모리는 주 메모리에서 데이터에 액세스하는 평균 시간을 줄이기 위해 사용된다. 캐시는 자주 사용되는 주 메모리 위치를 데이터 사본을 저장하는 더 작고 빠른 메모리이다. CPU에는 명령과 데이터를 저장하는 다양한 독립 캐시가 있다.

![img](https://media.geeksforgeeks.org/wp-content/uploads/cache.png)

#### 기억 수준

##### 1. 레벨 1 또는 레지스터

- CPU에 즉시 저장되는 데어터가 저장되고 받아 들여지는 메모리 유형이다. 가장 일반적으로 사용되는 레지스터는 누산기, 프로그램 카운터, 주소 레지스터 등이다.

##### 2. 레벨 2 또는 캐시 메모리

- 빠른 액세스를 위해 데이터가 임시로 저장되는 빠른 액세스 시간을 갖는 가장 빠른 메모리이다.

##### 3. 레벨 3 또는 Main Memory

- 현재 컴퓨터가 작동하는 메모리이며 크기가 작다. 전원이 꺼지면 더 이상 메모리에 데이터가 남아있지 않다.

##### 4. 레벨 4 또는 2차 메모리

- 주 메모리는 빠르지만 데이터는 이 메모리에 영구히 남아 있는 외부 메모리이다.

#### 캐시 성능

- 프로세서가 주 메모리에서 위치를 읽거나 쓰려면 먼저 캐시에서 해당 항목을 확인한다.
  - 프로세서가 메모리 위치가 캐시에 있음을 확인하면 캐시 적중이 발생하고 캐시에서 데이터를 읽는다.
  - 프로세서가 캐시에서 메모리 위치를 찾지 못하면 캐시 미스가 발생한다. 캐시 미스의 경우 캐시는 새 항목을 할당하고 주 메모리에서 데이터를 복사한 다음 요청이 캐시 내용에서 충족된다.
- 캐시 메모리의 성능은 **히트비율(Hit Ratio)**이라는 용어로 측정되는 경우가 많다.

```c
Hit ratio = hit / (hit + miss) =  no. of hits/total accesses
```



캐시 성능을 높이기 위해 다음과 같은 일들을 할 수 있다.

#### 캐시 맵핑

- 캐시 메모리의 용도로 사용되는 맵핑 유형에는 직접 맵핑, 연관 맵핑 및 세트 연관 맵핑의 세가지 유형이 있는데 다음과 같다.

##### 1. 직접 매핑 - 직접 매핑

- 주 메모리의 각 블록을 하나의 가능한 캐시 라인으로 매핑한다. 또는 직접 매핑에서 각 메모리 블록이 캐시의 특정 행에 할당된다. 새로운 블록을 로드 해야 할 때 라인이 메모리 블록에 의해 이전에 사용된 경우 이전 블록은 휴지통이다. 주소 공간은 인덱스 필드와 태그 필드의 두 분으로 나뉜다. 캐시는 태그 필드를 저장하는데 사용되고 나머지 주 메모리에 저장된다. 직접 매핑의 성능은 적중률에 직접 비례한다.

  ```c
  i = j modulo m
  where
  i=cache line number
  j= main memory block number
  m=number of lines in the cache
  ```

- 캐시 액세스를 위해 각 주 메모리 주소는 세 개의 필드로 구성된다. 최하위 w비트는 주 메모리 블록 내의 고유워드 또는 바이트를 식별한다. 대부분의 최신 컴퓨터에서 주소는 바이트 수준인데 나머지 s비트는 주 메모리의 2^s 블록 중 하나를 지정한다. 캐시 로직은 이들 s 비트를 sr 비트(최상위 부분)의 태그 및 r비트의 라인 필드로 해석한다. 이 후자의 필드는 캐시의 m=2^r라인 중 하나를 식별한다.

![img](https://media.geeksforgeeks.org/wp-content/uploads/20190305171558/1232.png)

![img](https://media.geeksforgeeks.org/wp-content/uploads/cache1.png)

##### 2. 연관 매핑

- 이 유형의 매핑에서 연관 메모리는 내용을 저장하고 메모리 단어를 모두 주소 지정하는 데 사용된다. 모든 블록은 캐시의 모든 행으로 이동할 수 있다. 즉, 단어 id비트는 블록의 어느 단어가 필요한지 식별하는 데 사용되지만 태그는 나머지 비트가 된다. 이렇게 하면 캐시 메모리의 어느 위치에서나 단어를 배치 할 수 있다. 그 자체로 가장 빠르고 유연한 매핑 형식으로 간주된다.

![img](https://media.geeksforgeeks.org/wp-content/uploads/cache2.png)

##### 3. 집합 연관 매핑(Set-associative Mapping)

- 이 매핑의 형식은 직접 매핑의 단점이 제거된 직접 매핑의 향상된 형식이다. 집합 연관은 직접 매핑 방법에서 가능한 쓰레싱 문제를 해결한다. 이는 블록이 캐시에서 매핑 할 수 있는 행이 정확히 하나가 아니라 여러 행을 그룹화하여 하나의 **세트**를 만드는 것이라고 말함으로써 이 작업을 수행한다. 그런 다음 메모리에 있는 블록이 특정 세트의 행 중 하나에 맵핑 될 수 있다. 세트 연관 맵핑을 사용하면 캐시에 있는 두 개 이상의 단어를 가질 수 있다. 집합 연관 캐시 맵핑은 최상의 직접 연관 매핑 기술과 결합 캐시 맵핑 기술을 결합한다.
- 이 경우 캐시는 여러 세트로 구성되며 각 세트는 여러 행으로 구성된다. 관계는 다음과 같다.

```c
m = v * k
i= j mod v

where
i=cache set number
j=main memory block number
v=number of sets
m=number of lines in the cache number of sets 
k=number of lines in each set 
```

![img](https://media.geeksforgeeks.org/wp-content/uploads/20190305171821/setassociative.png)

![img](https://media.geeksforgeeks.org/wp-content/uploads/cache4.png)

###### 캐시 메모리의 응용

1. 일반적으로 캐시 메모리는 주어진 시간에 적당한 수의 블록을 저장할 수 있지만 수는 주 메모리의 총 블록 수에 비해 적다.
2. 메인 메모리 블록들과 캐시 내의 것들 사이 대응은 맵핑 기능에 의해 지정된다.

###### 캐시 유형

- 기본 캐시
  - 기본 캐시는 항상 프로세서 칩에 있다. 이 캐시는 작고 액세스 시간은 프로세서 레지스터의 캐시 시간과 비슷하다.
- 보조 캐시
  - 보조 캐시는 기본 캐시와 나머지 메모리 사이에 위치한다. 이를 레벨 2(L2) 캐시라고 한다. 종종 레벨 2 캐시도 프로세서 칩에 내장되어 있다.



##### 지역 참조

- 캐시 메모리의 크기가 주 메모리에 비해 적기 때문에, 따라서 주 메모리의 어느 부분에 우선 순위를 부여하고 캐시에 로드해야 하는지 확인하는 것은 참조의 지역성에 따라 결정된다.

###### 참조의 지역 유형

1. Spatial Locality of reference
   - 이것은 reference point와 근접해 엘리먼트가 존재할 가능성이 있고, 다시 reference  point와 근접한 거리를 다시 찾으면 다음 번에 나타날 가능성이 있다고 말한다.
2. Reference of Temporal Locality
   - 최근 사용한 알고리즘이 사용되는에 단어 내에 페이지 오류가 발생할 때마다 주 메모리에 단어가 로드 될 뿐 아니라 전체 페이지 오류가 로드된다. 참조 규칙의 공간적 지역성은 단어를 참조하는 경우 다음 단어가 해당 레지스터에서 참조되어 로드된다. 완성 페이지 테이블을 사용해 전체 블록을 로드한다.

