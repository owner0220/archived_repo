- 학습을 위해 글을 올립니다.
- 모든 출처와 저작권은 Geeksforgeeks에 있습니다.

[^출처]: https://www.geeksforgeeks.org/



# 프로세스&쓰레드_원격 프로 시저 호출 (RPC)

- 원격 프로시저 호출(RPC)는 분산 된 클라이언트-서버 기반 응용프로그램을 구성하는 기술이다.
- 호출된 프로시저가 호출 프로시저와 동일한 주소 공간에 존재할 필요가 없도록 기존의 로컬 프로시저 호출을 확장하는 것을 기반으로 한다.
- 두 프로세스는 동일한 시스템에 있거나 네트워크를 연결하는 다른 시스템에 있을 수 있다.



##### 원격 프로 시저 호출을 할 때

![img](https://cdncontribute.geeksforgeeks.org/wp-content/uploads/operating-system-remote-procedure-call-1.png)

1. 호출 환경이 일시 중단되고, 프로시저 매개 변수가 시저가 실행될 환경으로 네트워크를 통해 전송되고 프로시저가 거기에서 실행된다.
2. 프로시저가 끝나고 결과가 생성되면 그 결과는 호출 환경으로 다시 전송된다. 호출 환경에서는 일반 프로시저 호출에서 돌아오는 것처럼 실행이 재개된다.

- **RPC**는 호출자와 수신자간에 제어 흐름이 번갈아 나타나는 클라이언트-서버 상호작용에 특히 적합하다. 개념 상 클라이언트와 서버는 동시에 실행되지 않는다. 대신 실행 쓰레드는 호출자에서 호출 수신자로 이동한 후 다시 호출한다.

##### RPC 작업

![img](https://cdncontribute.geeksforgeeks.org/wp-content/uploads/operating-system-remote-call-procedure-working.png)

###### RPC동안 다음 단계가 수행된다.

1. 클라이언트는 매개 변수를 전달하면서 클라이언트 스텁 프로시저를 호출한다. 클라이언트 스텁은 클라이언트의 자체 주소 공간 내에 상주한다.
2. 클라이언트 스텁은 매개 변수를 메시지로 marshall(pack)이라 한다. 마샬링에는 매개변수의 표현을 표준 형식으로 변환하고 각 매개 변수를 메시지로 복사하는 작업이 포함된다.
3. 클라이언트 스텁은 메시지를 전송 계층에 전달하고, 전송 계층은 이를 원격 서버 시스템으로 보낸다.
4. 서버에서 전송 계층은 메시지를 서버 스텀에 전달한다. 서버 스텁은 매개변수를 demarshall(언팩)하고 일반 프로시저 호출 메커니즘을 사용해 원하는 서버루틴을 호출한다.
5. 서버 프로시저가 완료되면 반환 값을 메시지로 마샬링하는 서버 스텁(예: 일반 프로시저 호출 리턴을 통해)으로 반환된다. 그런 다음 서버 스텁이 메시지를 전송 계층으로 전달한다.
6. 전송 계층은 클라이언트 전송 계층으로 결과 메시지를 다시 보내고 메시지는 클라이언트 스텁에 다시 전달된다.
7. 클라이언트 스텁은 리턴 매개 변수를 demarshall하고 실행은 호출자에게 리턴한다.

##### RPC문제

1. **RPC 런타임** : RPC 런타임 시스템은 RPC 메커니즘의 기초가 되는 네트워크 통신을 처리하는 루틴 라이브러리 및 서비스 집합이다. RPC 호출 과정에서 클라이언트 측 및 서버 측 런타임 시스템의 코드가 바인딩을 처리하고 적절한 프로토콜을 통해 통신을 설정하며 클라이언트와 서버간의 호출 데이터를 전달하고 통신 오류를 처리한다.
2. **스텁** : 스텁 기능은 프로그래머가 작성한 응용프로그램 코드에 투명성을 제공하는 것이다.
   - **클아이언트 측**에서 스텁은 클라이언트 로컬 프로시저 호출과 런타임 시스템 간의 인터페이스, 데이터 마샬링 및 언 마샬링, RPC 런타임 프로토콜 호출, 요청된 경우 바인딩 단계 수행 중 일부를 처리한다.
   - **서버 측**에서 그루터기는 런타임 시스템과 서버에 의해 실행되는 로컬 매니터 프로시저간에 유사한 인터페이스를 제공한다.
3. **바인딩** : 고객은 전화할 대상과 서비스가 있는 대상을 어떻게 알까?
   - 가장 유연한 솔루션은 동적 바인딩을 사용하고 RPC가 처음 만들어 질 때 런타임에 서버를 찾는 것이다. 처음으로 클라이언트 스텁이 호출되면 이름 서버에 접속해 서버가 상주하는 전송 주소를 판별한다.

##### 바인딩

- **이름 지정**
  - 원격 프로시저는 인터페이스를 통해 명명된다. 인터페이스는 특정 서비스를 고유하게 식별해 인수의 유형과 수를 설명한다. 이는 프로그램 언어에서 유형 정의와 목적이 비슷한다.
- **위치**
  - 서버가 실제로 상주하는 전송 주소 찾기, 서비스의 전송 주소가 있으면 서버에 직접 메시지를 보낼 수 있다.
  - 제공할 서비스가 있는 서버는 인터페이스 내보내기를 한다. 인터페이스를 내보내면 클라이언트가 사용할 수 있도로 시스템에 등록한다.
  - 통신이 시작되기 전에 클라이언트는 내보낸 인터페이스를 가져와야 한다.

##### 장점

1. RPC는 추상화를 제공한다. 즉, 사용자가 네트워크 통신의 메시지 전달 특성을 숨긴다.
2. RPC는 종종 성능을 향상시키기 위해 많은 프로토콜 계층을 생략한다. 프로그램이 RPC를 자주 호출 할 수 있기 때문에 작은 성능 향상도 중요하다.
3. RPC는 로컬 환경에서뿐만 아니라 분산환경에서 응용프로그램의 사용을 가능하게 한다.
4. RPC코드를 사용해 다시 작성 / 재개발 노력을 최소화 한다.
5. RPC가 지원하는 프로세스 지향 및 스레드 지향 모델