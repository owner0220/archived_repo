# 비트코인 암호 기초

### 관련 보안기술 기초

1. 해시함수(인터넷 지문)

```html
H(x)=h
1:1 관계이지만 결과 h 값만으로 x를 찾는 것은 불가능하다. (그래서 작업증명이나 인증서로 활용한다.)
```

**M**(보내려고 하는 메시지) + E(**M**' , k-)

※ M' 는 보내려고 하는 메시지를 해시 함수로 암호화한 해시 값, k-는 개인키

**E**ncript( 서명 ) 암호화 하는 과정을 거친다.



2. 공개키 암호

공개키 k+, 개인키 k- 는 서로 암호화, 복호화를 할 수 있다.

예를 들어 개인키는 (암호화과정을 거쳐서 만들어진) 서명을 생성하고,

공개키(메시지를 해시과정을 거쳐 만들어진 값을 주소로 사용한다.)를 이용해 주소를 생성, 서명을 검증한다.



3. 서명

- 메시지와 서명을 전송

```M+E( H(M), k- )```

**M** 보낸 메시지

**E()** 개인키(k-)를 이용해 암호화 해주는 함수

**H()** 해시값을 갖게 해주는 해시함수(암호화 함수)



- 메시지 해석

```DE( E( H( M ) , k- ), k+)```  = ```H( M )```

**DE()** 공개키 k+를 필요로 사용하는 복호화 함수

**E()** 개인키 k-를 필요로 사용하는  암호화 함수

복호화 해서 원래 전달하고자 했던 메시지의 해시값과 같을 때 거래 생성자 확인, 특정 주소의 코인 소유자를 확인할 수 있다.





### 비트 코인이란?

- 통화의 이름  (**BTC**)
- 통화가 운영되는 네트워크 시스템 전체를 통칭하는 이름
- 사토시 나카모토 2008년 비트코인 : P2P 전자화폐시스템 논문
- **참여자간 직접 전자 현금 지불 시스템**

#### 등장 배경

- 은행 비용발생, 거래 상대방 위험 발생 >> 비트코인으로 직접 거래를 하자!
- 은행 없이 사용자끼리 거래, 투명 장부 >> 탈중앙, 투명한 화폐 발행
- Ledger 승인되면 변경불가

#### 보안

- 기존 네트워크 연결의 이웃노드들과 TCP 연결로 비트코인 네트워크 가입
- 8개 이상의 이웃노드와 항상 연결되도록 권고
- 방송 형태의 전송(전 노드에 거래 정보 발송) >> 목적지 IP 주소 지정 불필요
- P2P 방식으로 거래가 이뤄지도록 Public ledger 블록체인 원장을 기록한다.

#### 구성원

- 채굴자 : 블록을 생성, 체인을 연결하는 참여자
- 채굴자 결정 : 작업증명 알고리즘을 통해 채굴역량에 비례하는 확률로 채굴자 자동 선정
- 발생방식 : 채굴자 주소로 블록보상(12.5 BTC) 송신 지불거래 자동생성

#### 소유자 증명 방식(Locking Script)

- Locking Script를 해지할 수 있는 사람이 소유자로 증명된다.
- 지불거래의 성립
  - **입력** 사용대상 비트코인 지정 : 블록체인 상에서 비트코인이 저장된 특정 지불거래에 대한 해시 포인터
  - **입력** 소유자 증명 : 지정된 거래로 지불된 비트코인의 수신자임을 증명
  - **출력** 새로운 수신자 지정 : 지불된 비트 코인의 금액, 새로운 소유자 주소와 소유자 증명 방식지정

#### UTXO(Unspent Transaction Output)

- 지불거래(화폐발행포함)에 의해 송신된 후 사용되지 않은 화폐
- 새로운 지불거래에 해시포인터(거래ID)로 지정되지 않은 지불거래의 수신자 주소에 기록된 비트코인

#### STXO(Spent Transaction Output)

- 지불거래(발행포함)에 의해 송신된 후 이미 사용된 화폐
- 다음 지불거래 해시포인터(거래ID)로 지정된 지불거래의 수신자 주소에 기록된 비트코인



※발행 비트코인 총액

블록체인 상 UTXO 총합과 같다.

내 지갑의 비트코인 총액 = 내 지갑이 보유하고 있는 주소들에 대응되는 UTXO의 총합

여기서 UTXO,STXO는 이중지불을 설명하기 위해 돈을 개념적으로 이분해 놓은 것이라고 생각하면 편하다. 중심을 비트코인 네트워크 은행으로 생각했을 때 UTXO는 발행한 총 화폐수 이고 나를 중심으로 생각해보면 내 지갑에 들어 있는 현재 비트코인 수를 말하는 것과 동일



#### 이중지불(Double Spending)

- 이미 사용된 STXO를 다시 지불
- H(거래k) 거래에 대한 해시값만 확인하면 중복거래인지 확인이 가능하기 때문에 이중지불이 불가하다.



